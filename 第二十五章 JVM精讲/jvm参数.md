# JVM参数

在JVM调整过程中，主要是对JVM参数做的调整，以下我们队JVM主要参数做逐⼀介绍。JVM参数有 很多，其实我们直接使⽤默认的JVM参数，不去修改都可以满⾜⼤多数情况。但是如果你想在有限的硬 件资源下，部署的系统达到最⼤的运⾏效率，那么进⾏相关的JVM参数设置是必不可少的。下⾯我们就 来对这些JVM参数进⾏详细的介绍。

JVM参数主要分为以下三种：标准参数、⾮标准参数、不稳定参数。

# 1 标准参数

标准参数，顾名思义，标准参数中包括功能以及输出的结果都是很稳定的，基本上**不会随着\****JVM***\*版本的变化⽽变化**。标准参数以-开头，如：java -version、java -jar等，通过java -help可以查询所有的标准参数，

我们可以通过 -help 命令来检索出所有标准参数。

关于这些命令的详细解释，可以参考官⽹：

https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html

-help 也是⼀个标准参数，再⽐如使⽤⽐较多的 -version也是。显示Java的版本信息。

# 2 ⾮标准参数

⾮标准参数以-X开头，是标准参数的扩展。对应前⾯讲的标准化参数，这是⾮标准化参数。表示在 将来的JVM版本中可能会发⽣改变，但是这类以-X开始的参数变化的⽐较⼩。

我们可以通过 Java -X 命令来检索所有-X 参数。

我们可以通过设置⾮标准参数来配置堆的内存分配，常⽤的⾮标准参数有：

-Xmn新⽣代内存的最⼤值，包括Eden区和两个Survivor区的总和，写法如：-Xmn1024，- Xmn1024k，-Xmn1024m，-Xmn1g 。

-Xms堆内存的最⼩值，默认值是总内存/64（且⼩于1G），默认情况下，当堆中可⽤内存⼩于40% (这个值可以⽤-XX: MinHeapFreeRatio 调整，如-X:MinHeapFreeRatio=30)时，堆内存会开始增加，⼀直增加到-Xmx的⼤⼩。

-Xmx堆内存的最⼤值，默认值是总内存/64（且⼩于1G），如果Xms和Xmx都不设置，则两者⼤⼩ 会相同，默认情况下，当堆中可⽤内存⼤于70%时，堆内存会开始减少，⼀直减⼩到-Xms的⼤⼩；

整个堆的⼤⼩=年轻代⼤⼩+年⽼代⼤⼩，堆的⼤⼩不包含持久代⼤⼩，如果增⼤了年轻代，年⽼代 相应就会减⼩，官⽅默认的配置为年⽼代⼤⼩/年轻代⼤⼩=2/1左右；

建议在开发测试环境可以⽤Xms和Xmx分别设置最⼩值最⼤值，但是在线上⽣产环境，Xms和Xmx 设置的值必须⼀样，原因与年轻代⼀样——防⽌抖动；

-Xss每个线程的栈内存，默认1M，⼀般来说是不需要改的。

-Xrs减少JVM对操作系统信号的使⽤。

-Xprof跟踪正运⾏的程序，并将跟踪数据在标准输出输出；适合于开发环境调试。

-Xnoclassgc关闭针对class的gc功能；因为其阻⽌内存回收，所以可能会导致OutOfMemoryError

错误，慎⽤；

-Xincgc开启增量gc（默认为关闭）；这有助于减少⻓时间GC时应⽤程序出现的停顿；但由于可能 和应⽤程序并发执⾏，所以会降低CPU对应⽤的处理能⼒。

-Xloggc:ﬁle与-verbose:gc功能类似，只是将每次GC事件的相关情况记录到⼀个⽂件中，⽂件的位 置最好在本地，以避免⽹络的潜在问题。

# 3 不稳定参数

这是我们⽇常开发中接触到最多的参数类型。这也是⾮标准化参数，相对来说不稳定，随着JVM版 本的变化可能会发⽣变化，主要⽤于**JVM\****调优**和debug。

不稳定参数以-XX 开头，此类参数的设置很容易引起JVM 性能上的差异，使JVM存在极⼤的不稳定性。如果此类参数设置合理将⼤⼤提⾼JVM的性能及稳定性。

不稳定参数分为三类：

性能参数：⽤于JVM的性能调优和内存分配控制，如内存⼤⼩的设置；

⾏为参数：⽤于改变JVM的基础⾏为，如GC的⽅式和算法的选择； 调试参数：⽤于监控、打印、输出jvm的信息；

## 不稳定参数语法规则：

布尔类型参数值：

-XX:+

-XX:-

示例：-XX:+UseG1GC：表示启⽤G1垃圾收集器

数字类型参数值：

-XX:

示例：-XX:MaxGCPauseMillis=500 ：表示设置GC的最⼤停顿时间是500ms

字符串类型参数值：

-XX:

示例：-XX:HeapDumpPath=./dump.core

# 4 常⽤参数

如以下参数示例

上⾯为Java7及以前版本的示例，在Java8中永久代的参数-XX:PermSize和-XX:MaxPermSize已经失 效。这在前⾯章节中已经讲到。

## 参数解析：

-Xms4g：初始化堆内存⼤⼩为4GB，ms是memory start的简称，等价于-XX:InitialHeapSize。

-Xmx4g：堆内存最⼤值为4GB，mx是memory max的简称，等价于-XX:MaxHeapSize。

-Xmn1200m：设置年轻代⼤⼩为1200MB。增⼤年轻代后，将会减⼩年⽼代⼤⼩。此值对系统性 能影响较⼤，Sun官⽅推荐配置为整个堆的3/8。

-Xss512k：设置每个线程的堆栈⼤⼩。JDK5.0以后每个线程堆栈⼤⼩为1MB，以前每个线程堆栈

⼤⼩为256K。应根据应⽤线程所需内存⼤⼩进⾏调整。在相同物理内存下，减⼩这个值能⽣成更 多的线程。但是操作系统对⼀个进程内的线程数还是有限制的，不能⽆限⽣成，经验值在3000~5000左右。

-XX:NewRatio=4：设置年轻代（包括Eden和两个Survivor区）与年⽼代的⽐值（除去持久代）。 设置为4，则年轻代与年⽼代所占⽐值为1：4，年轻代占整个堆栈的1/5

-XX:SurvivorRatio=8：设置年轻代中Eden区与Survivor区的⼤⼩⽐值。设置为8，则两个Survivor

区与⼀个Eden区的⽐值为2:8，⼀个Survivor区占整个年轻代的1/10

-XX:PermSize=100m：初始化永久代⼤⼩为100MB。

-XX:MaxPermSize=256m：设置持久代⼤⼩为256MB。

-XX:MaxTenuringThreshold=15：设置垃圾最⼤年龄。如果设置为0的话，则年轻代对象不经过Survivor区，直接进⼊年⽼代。对于年⽼代⽐较多的应⽤，可以提⾼效率。如果将此值设置为⼀个 较⼤值，则年轻代对象会在Survivor区进⾏多次复制，这样可以增加对象再年轻代的存活时间，增 加在年轻代即被回收的概论。

-XX:MaxDirectMemorySize=1G：直接内存。报java.lang.OutOfMemoryError: Direct buﬀer memory异常可以上调这个值。

-XX:+DisableExplicitGC：禁⽌运⾏期显式地调⽤System.gc()来触发fulll GC。

注意: Java RMI的定时GC触发机制可通过配置-Dsun.rmi.dgc.server.gcInterval=86400来控制触发的时间。